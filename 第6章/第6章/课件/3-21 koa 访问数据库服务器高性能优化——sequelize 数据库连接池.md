# 3-21 koa 访问数据库服务器高性能优化——sequelize 数据库连接池

##### 1. 为什么要用数据库连接池？

产生背景：当一个网站并发量达到百级，千级以上（假设网站一天9万访问量），后端服务器就会和数据库服务器创建9万次连接，关闭9万次连接，而数据库创建连接非常消耗时间，关闭连接也消耗时间，严重的浪费数据库的资源，并且极易造成数据库服务器内存溢出、拓机。

**2. 什么是连接池？**

数据库连接池是负责创建，分配，释放数据库连接的对象，在项目启动时会创建一定数量的数据库连接放到连接池对象中，并允许应用程序重复使用一个现有的数据库连接，而不是重新建立一个。

**在 Sequelize 底层：连接池是一个由 ConnectionManager 类管理的 Pool 类的对象，通过 Pool 类对象来管理和共享多个连接对象。**

##### 3.连接池如何工作？

 数据库连接池在初始化时将创建一定数量的数据库连接放到连接池中， 这些数据库连接的数量是由最小数据库连接数来设定的。连接池的最大数据库连接数量限定了这个连接池能占有的最大连接数，当应用程序向连接池请求的连接数超过最大连接数量时,这些请求将被加入到等待队列中。

将数据库连接作为对象存储在内存中，当用户需要访问数 据库时，并非建立一个新的连接，而是从连接池中取出一个已建立的空闲连接对象。使用完毕后，用户 也并非将连接关闭，而是将连接放回连接池中，以供下一个请求访问使用。而连接的建立、断开都由连 接池自身来管理。

